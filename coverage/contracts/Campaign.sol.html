<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Campaign.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Campaign.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>50/50</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">96.43% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>27/28</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>13/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>56/56</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">44×</span>
<span class="cline-any cline-yes">42×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">33×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-yes">52×</span>
<span class="cline-any cline-yes">52×</span>
<span class="cline-any cline-yes">52×</span>
<span class="cline-any cline-yes">52×</span>
<span class="cline-any cline-yes">44×</span>
<span class="cline-any cline-yes">84×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">65×</span>
<span class="cline-any cline-yes">61×</span>
<span class="cline-any cline-yes">57×</span>
<span class="cline-any cline-yes">53×</span>
<span class="cline-any cline-yes">49×</span>
<span class="cline-any cline-yes">49×</span>
<span class="cline-any cline-yes">49×</span>
<span class="cline-any cline-yes">49×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">97×</span>
<span class="cline-any cline-yes">93×</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-yes">89×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: GPL-3.0
pragma solidity 0.8.6;
pragma abicoder v2;
&nbsp;
import "./interfaces/ICampaign.sol";
import "./interfaces/ICampaignFactory.sol";
&nbsp;
contract Campaign is ICampaign {
&nbsp;
    uint256 public createAt;
    uint256 public lastUpdatedAt;
    address public manager;
    address public factory;
    bool public isDisabled;
&nbsp;
    Info public campaignInfo;
    mapping(uint =&gt; Rewards) public rewardsList;
    uint256 public rewardsCounter;
&nbsp;
&nbsp;
    //    Events
    event newCampaign();
    event CampaignNewRewardsAdded(uint rewardsCounter);
    event CampaignInfoUpdated();
    event CampaignRewardsUpdated();
    event CampaignDisabled();
    event CampaignRewardDeleted();
&nbsp;
    //Modifiers
    modifier isNotDisabled(){
        require(!isDisabled, "!Err: Disabled");
        _;
    }
&nbsp;
    modifier onlyManager(){
        require(msg.sender == manager, "!Not Authorized");
        _;
    }
&nbsp;
    constructor(Info memory infoData, Rewards[] memory rewardsData, address _manager)
    {
        require(rewardsData.length &gt; 0, "!Err: Rewards empty");
        manager = _manager;
        factory = msg.sender;
        createAt = block.timestamp;
        _setCampaignInfo(infoData);
        for (rewardsCounter; rewardsCounter &lt; rewardsData.length; rewardsCounter++) {
            _setCampaignReward(rewardsCounter, rewardsData[rewardsCounter]);
        }
    }
&nbsp;
    function updateAllInfoData(Info memory updatedInfoData) external override isNotDisabled() onlyManager() {
        _setCampaignInfo(updatedInfoData);
        emit CampaignInfoUpdated();
    }
&nbsp;
    function addReward(Rewards memory newRewardData) external override isNotDisabled() onlyManager() {
        rewardsCounter++;
        _setCampaignReward(rewardsCounter, newRewardData);
        emit CampaignNewRewardsAdded(rewardsCounter);
    }
&nbsp;
    function updateAllRewardsData(Rewards[] memory updatedRewardsData) external override isNotDisabled() onlyManager {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(updatedRewardsData.length &gt; 0, "!Err: Rewards empty");
        for (uint i = 0; i &lt; rewardsCounter; i++) {
            delete rewardsList[i];
        }
        rewardsCounter = 0;
        for (rewardsCounter; rewardsCounter &lt; updatedRewardsData.length; rewardsCounter++) {
            _setCampaignReward(rewardsCounter, updatedRewardsData[rewardsCounter]);
        }
        emit CampaignRewardsUpdated();
    }
&nbsp;
    function updateRewardData(Rewards memory newRewardData, uint rewardIndex) external override isNotDisabled() onlyManager() {
        require(rewardIndex &lt;= rewardsCounter, "!Err: Index not exist");
        _setCampaignReward(rewardIndex, newRewardData);
        emit CampaignRewardsUpdated();
    }
&nbsp;
    function _setCampaignInfo(Info memory data) private {
        require(bytes(data.title).length &gt; 0, "!Err: Title empty");
        require(bytes(data.description).length &gt; 0, "!Err: Description empty");
        require(data.fundingGoal &gt;= 10000, "!Err: Funding Goal not enough");
        require(createAt + data.durationDays * 1 days &gt;= block.timestamp + 7 days, "!Err: durationDays to short");
        campaignInfo.title = data.title;
        campaignInfo.description = data.description;
        campaignInfo.fundingGoal = data.fundingGoal;
        campaignInfo.durationDays = data.durationDays;
    }
&nbsp;
    function _setCampaignReward(uint index, Rewards memory data) private {
        require(bytes(data.title).length &gt; 0, "!Err: Title empty");
        require(bytes(data.description).length &gt; 0, "!Err: Description empty");
        Rewards memory r;
        r.title = data.title;
        r.description = data.description;
        r.minimumContribution = data.minimumContribution;
        r.stockLimit = data.stockLimit;
        r.nbContributors = data.nbContributors;
        r.isStockLimited = data.isStockLimited;
        rewardsList[index] = r;
    }
&nbsp;
    function deleteCampaign() external override isNotDisabled() onlyManager() {
        isDisabled = true;
        ICampaignFactory(factory).deleteCampaign();
        emit CampaignDisabled();
    }
&nbsp;
    function deleteReward(uint256 rewardIndex) external override isNotDisabled() onlyManager() {
        require(rewardIndex &lt;= rewardsCounter, "!Err: Index not exist");
        if(rewardsCounter!=rewardIndex){
            rewardsList[rewardIndex] = rewardsList[rewardsCounter];
        }
        delete rewardsList[rewardsCounter];
        rewardsCounter--;
        emit CampaignRewardDeleted();
    }
&nbsp;
    function updateManager(address newManager) external override onlyManager() {
        manager = newManager;
    }
&nbsp;
    function updateFactory(address newFactory) external {
        require(factory == msg.sender, "!Err: Not Factory Contract");
        factory = newFactory;
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Jul 16 2021 01:19:57 GMT+0300 (Eastern European Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
